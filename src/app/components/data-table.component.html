<!-- data-table.component.html -->
<div class="table-top">
    <h4 class="table-title">{{ title }} <span class="record-count">({{ recordCount }} inreg.)</span></h4>
</div>
<!-- Filtrele -->
<div class="table-filter-area w3-container w3-light-grey" *ngIf="filterForm$ | async as filterForm">
    <div class="table-filter-reset w3-left">
        <button
          class="w3-button w3-round"
          (click)="onResetFilters()"
        ><i class="fas fa-times"></i></button>
    </div>    
    <div class="table-filter-fields">
        <!-- <form [formGroup]="filterForm" class="w3-row filter-field"> -->
        <form *ngIf="filterFormSubject | async as filterForm" [formGroup]="filterForm" class="table-filter-form">
          <div *ngFor="let field of filterFields" class="filter-field">
            <label class="w3-text-dark-grey">{{ field.label }}</label>
            <input
              *ngIf="field.type === 'text'"
              class="w3-border w3-round"
              type="text"
              [formControlName]="field.name"
              placeholder="{{ field.label }}..."
            />
            <input
              *ngIf="field.type === 'date'"
              class="w3-border w3-round"
              type="date"
              [formControlName]="field.name"
            />
          </div>
        </form>
    </div>
    <div class="table-filter-refresh w3-right">
        <button class="w3-button w3-round w3-text-white" (click)="onRefresh()"><i class="fas fa-refresh"></i></button>
    </div>
</div>
<div class="table-container w3-container">
    <table class="w3-table w3-small w3-striped w3-bordered w3-hoverable">
        <thead>
            <!-- 
            <tr class="table-header">
                <th *ngFor="let col of columns; let i = index" 
                    class="column-title" 
                    (click)="sortData(col.name)"
                    [ngStyle]="{'width': getColumnWidth(col)}">
                    <span [ngClass]="{'sorted': sortColumn === col.name}">{{ col.label }}</span>
                    <span *ngIf="sortColumn === col.name" class="arrow">
                        {{ sortDirection === 'asc' ? '▲' : '▼' }}
                    </span>
                </th>
              </tr>           
            <tr class="table-search">
                <th *ngFor="let column of selectedColumns" class="column-search">
                    <input 
                        class="w3-input"
                        type="text" 
                        [ngModel]="getSearchValue(column)" 
                        (ngModelChange)="setSearchValue(column, $event); filterData()" 
                        placeholder="{{ column }}..." />
                </th>
            </tr>
            -->
            <tr class="table-header">
                <th *ngFor="let col of columns" 
                    class="column-title" 
                    (click)="sortData(col.name)"
                    [ngStyle]="getCellStyle(col)">
                  <span [ngClass]="{'sorted': sortColumn === col.name}">{{ col.label }}</span>
                  <span *ngIf="sortColumn === col.name" class="arrow">
                    {{ sortDirection === 'asc' ? '▲' : '▼' }}
                  </span>
                </th>
              </tr>
              <tr class="table-search">
                <th *ngFor="let col of columns" [ngStyle]="getCellStyle(col)">
                  <!-- Exemplu: un input pentru filtrare -->
                  <input *ngIf="col.searchable" type="text" 
                         placeholder="Search {{ col.label }}" 
                         (input)="setSearchValue(col.name, $event.target.value)" 
                         [value]="getSearchValue(col.name)">
                </th>
              </tr>

        </thead>

        <tbody>
            <!--
            <tr *ngFor="let item of filteredData">
                <td *ngFor="let colName of selectedColumns"
                    [ngClass]="getAlignmentClass(getColumnDefinition(colName)!)"
                    [ngStyle]="{'width': getColumnWidth(getColumnDefinition(colName)!)}">
                  <ng-container *ngIf="getColumnDefinition(colName) as colDef">
                    <ng-container [ngSwitch]="colDef.type">
                      <ng-container *ngSwitchCase="'check'">
                        <span *ngIf="isChecked(item, colDef)">✓</span>
                        <span *ngIf="!isChecked(item, colDef)">&nbsp;</span>
                      </ng-container>
                      <ng-container *ngSwitchCase="'numeric'">
                        {{ formatNumber(item[colName], colDef) }}
                      </ng-container>
                      <ng-container *ngSwitchDefault>
                        {{ item[colName] }}
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
            -->
            <tr *ngFor="let item of filteredData">
                <td *ngFor="let colName of selectedColumns"
                    [ngClass]="getAlignmentClass(getColumnDefinition(colName)!)"
                    [ngStyle]="getCellStyle(getColumnDefinition(colName)!)">
                  <ng-container *ngIf="getColumnDefinition(colName) as colDef">
                    <ng-container [ngSwitch]="colDef.type">
                      <!-- Tip 'check': afișează bifă (✓) -->
                      <ng-container *ngSwitchCase="'check'">
                        <span *ngIf="isChecked(item, colDef)">✓</span>
                        <span *ngIf="!isChecked(item, colDef)">&nbsp;</span>
                      </ng-container>
                      <!-- Tip 'numeric': afișează valoarea formatată -->
                      <ng-container *ngSwitchCase="'numeric'">
                        {{ formatNumber(item[colName], colDef) }}
                      </ng-container>
                      <!-- Alte tipuri -->
                      <ng-container *ngSwitchDefault>
                        {{ item[colName] }}
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
              <tr *ngIf="showTotals()" class="total-row">
                <td *ngFor="let colName of selectedColumns">
                  <ng-container *ngIf="getColumnDefinition(colName) as colDef">
                    <div [ngClass]="getAlignmentClass(colDef)" [ngStyle]="getCellStyle(colDef)">
                      <ng-container *ngIf="isNumericColumn(colDef) && canShowTotal(colDef)">
                        {{ calculateTotal(colName) }}
                      </ng-container>
                      <ng-container *ngIf="!isNumericColumn(colDef) || !canShowTotal(colDef)">
                        &nbsp;
                      </ng-container>
                    </div>
                  </ng-container>
                </td>
              </tr>
            <!--
              <tr *ngIf="showTotals()" class="total-row">
                <td *ngFor="let colName of selectedColumns"
                    [ngClass]="{'text-right': isNumericColumn(getColumnDefinition(colName)!)}"
                    [ngStyle]="{'width': getColumnWidth(getColumnDefinition(colName)!)}">
                  <ng-container *ngIf="isNumericColumn(getColumnDefinition(colName)!) && canShowTotal(getColumnDefinition(colName)!)">
                    {{ calculateTotal(colName) }}
                  </ng-container>
                  <ng-container *ngIf="!isNumericColumn(getColumnDefinition(colName)!) || !canShowTotal(getColumnDefinition(colName)!)">
                    {{ '' }}
                  </ng-container>
                </td>
              </tr>
            -->
        </tbody>

    </table>
</div>

                <!-- 
                <div class="w3-col s6">
                    <h4>Selectați Coloane:</h4>
                    <div *ngFor="let column of columns" class="search-input">
                        <label>
                            <input type="checkbox" [checked]="selectedColumns.includes(column)" (change)="toggleColumn(column)" />
                            {{ column }}
                        </label>
                    </div>
                </div>
            -->
